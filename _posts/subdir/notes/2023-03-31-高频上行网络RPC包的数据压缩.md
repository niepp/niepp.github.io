# 1. 前言
> 客户端的上行高频RPC同步包，往往会占用很大的网络数据带宽，这里给出一个针对非可靠高频上行RPC的网络带宽压缩方案。

# 2. 方案思路
高频的RPC同步包序列，很多时候，相邻同步包序列里的数据本身变化并不大，某些字段可能根本没有变化，有些数值变化了，变化量相对也很小。考虑发送序列间的差量数据，然后在接收端还原出全量数据，这对高频的RPC来说，可以节省大量的带宽。

# 3. 浮点数量化
## 3.1 FVector的量化
以FVector_NetQuantize10为例，量化需要的bit数取决于三个数据成员（x, y, z）中绝对值最大的那个数。
| 数据范围                | 量化需要的bit数 |
| ----------------------- | --------------- |
| 0 ~ 0.150000            | 11              |
| ~ 0.350000              | 14              |
| ~ 0.750000              | 17              |
| ~ 1.550000              | 20              |
| ~ 3.150000              | 23              |
| ~ 6.349999              | 26              |
| ~ 12.749999             | 29              |
| ~ 25.549997             | 32              |
| ~ 51.149998             | 34              |
| ~ 102.349991            | 37              |
| ~ 204.749985            | 40              |
| ~ 409.549957            | 43              |
| ~ 819.149963            | 46              |
| ~ 1638.349854           | 49              |
| ~ 3276.749756           | 52              |
| ~ 6553.549316           | 55              |
| ~ 13107.149414          | 59              |
| ~ 26214.347656          | 62              |
| ~ 52428.746094          | 65              |
| ~ 104857.539063         | 68              |
| ~ 209715.140625         | 71              |
| ~ 419430.312500         | 74              |
| ~ 838860.687500         | 77              |
| 838860.750000 ~ FLT_MAX | 80              |

| 数据范围                 | 量化需要的bit数 |
| ------------------------ | --------------- |
| 0 ~ -0.150000            | 11              |
| ~ -0.350000              | 14              |
| ~  -0.750000             | 17              |
| ~  -1.550000             | 20              |
| ~  -3.150000             | 23              |
| ~  -6.350000             | 26              |
| ~  -12.750000            | 29              |
| ~  -25.549999            | 32              |
| ~  -51.150002            | 34              |
| ~  -102.349998           | 37              |
| ~  -204.750000           | 40              |
| ~  -409.549988           | 43              |
| ~  -819.150024           | 46              |
| ~  -1638.349976          | 49              |
| ~  -3276.750000          | 52              |
| ~  -6553.549805          | 55              |
| ~  -13107.150391         | 59              |
| ~  -26214.349609         | 62              |
| ~  -52428.750000         | 65              |
| ~  -104857.546875        | 68              |
| ~  -209715.156250        | 71              |
| ~  -419430.343750        | 74              |
| ~  -838860.750000        | 77              |
| -838860.812500 ~ FLT_MIN | 80              |


# 3. 差量压缩
## 3.1 浮点数值
> 浮点数值做减法
> 二进制数值做异或